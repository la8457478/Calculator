# 蓄势待发 (Pending) 规则逻辑总结

## 📊 数据基础

使用 **最近3根周K线** (w1, w2, w3):
- **w1**: 倒数第3根K线 (起点)
- **w2**: 倒数第2根K线 (Peak/Trough - 高点/低点)
- **w3**: 最新K线 (当前)

---

## 🟢 做多方向 (Pending Long)

### 核心逻辑
识别**先涨后回调**的3根K线形态,w2创造高点,w3回调但尚未突破。

### 四个关键条件

#### 1️⃣ 有明显上涨
```python
w2.high > w1.high
```
- **含义**: w2的高点高于起点w1
- **说明**: 证明有一波上涨行情

#### 2️⃣ 未跌破支撑
```python
w3.close > w1.low
```
- **含义**: 当前收盘价高于起点低点
- **说明**: 回调未破坏支撑,趋势完好
- **支撑位**: w1.low

#### 3️⃣ 尚未突破
```python
w3.close <= w2.high
```
- **含义**: 当前收盘价未突破w2高点
- **说明**: 还在整理阶段,等待突破确认
- **阻力位**: w2.high

#### 4️⃣ 确实回调 (🆕)
```python
w3.high < w2.high
```
- **含义**: w3的最高点低于w2的最高点
- **说明**: 确保w3是真正的回调K线,而非继续上涨
- **作用**: 过滤掉假信号

### 形态示意 (3根K线)
```
价格
 ↑
 │         w2 (峰值)
 │          ┌──┐  ← 阻力位 w2.high
 │          │  │
 │      ┌──┘  └──┐
 │      │         │ w3 (回调,蓄势中)
 │   w1 │         └──•  ← 当前 w3.close
 │   ┌─┘              
 │   │  ← 支撑位 w1.low
 └───────────────────→ 时间
    w1    w2    w3

条件: w2.high > w1.high (上涨)
      w3.close > w1.low (未破支撑)
      w3.close <= w2.high (未突破,等待中)
```

---

## 🔴 做空方向 (Pending Short)

### 核心逻辑
识别**先跌后反弹**的3根K线形态,w2创造低点,w3反弹但尚未破位。

### 三个关键条件

#### 1️⃣ 有明显下跌
```python
w2.low < w1.low
```
- **含义**: w2的低点低于起点w1
- **说明**: 证明有一波下跌行情

#### 2️⃣ 未突破阻力
```python
w3.close < w1.high
```
- **含义**: 当前收盘价低于起点高点
- **说明**: 反弹未破坏阻力,趋势向下
- **阻力位**: w1.high

#### 3️⃣ 尚未破位
```python
w3.close >= w2.low
```
- **含义**: 当前收盘价未跌破w2低点
- **说明**: 还在反弹阶段,等待破位确认
- **支撑位**: w2.low

---

## ⚡ Pending vs Active 的区别

|  | **Pending (蓄势)** | **Active (已触发)** |
|---|---|---|
| **做多** | `w3.close <= w2.high` | `w3.close > w2.high` |
| **做空** | `w3.close >= w2.low` | `w3.close < w2.low` |
| **含义** | 形态已成,等待突破/破位 | 已经突破/破位确认 |
| **操作** | 🟡 观察,准备入场 | 🟢 可以入场 |

---

## 🎯 实际案例 (3根K线规则)

### 案例1: 玉米 C2605 ✅

#### 最后3根周K线数据
```
w1 (01-18): High 2290, Low 2262
w2 (01-25): High 2295, Low 2259, Close 2287
w3 (02-08): High 2282, Low 2260, Close 2279
```

#### 规则验证
1. ✅ **w2.high (2295) > w1.high (2290)** - 有明显上涨
2. ✅ **w3.close (2279) > w1.low (2262)** - 未跌破支撑
3. ✅ **w3.close (2279) <= w2.high (2295)** - 尚未突破

#### 结论
🟡 **pending_long** - 等待突破 **2295**

---

### 案例2: 菜油 OI2605 ✅

#### 最后3根周K线数据
```
w1 (01-25): High 9040, Low 8860
w2 (02-01): High 9488, Low 8998, Close 9380
w3 (02-08): High 9416, Low 9058, Close 9144
```

#### 规则验证
1. ✅ **w2.high (9488) > w1.high (9040)** - 有明显上涨
2. ✅ **w3.close (9144) > w1.low (8860)** - 未跌破支撑
3. ✅ **w3.close (9144) <= w2.high (9488)** - 尚未突破

#### 结论
🟡 **pending_long** - 等待突破 **9488**

---

### 案例3: 花生 PK2605 ✅

#### 最后3根周K线数据
```
w1 (01-25): High 7898, Low 7820
w2 (02-01): High 7960, Low 7870, Close 7906
w3 (02-08): High 7936, Low 7874, Close 7918
```

#### 规则验证
1. ✅ **w2.high (7960) > w1.high (7898)** - 有明显上涨
2. ✅ **w3.close (7918) > w1.low (7820)** - 未跌破支撑
3. ✅ **w3.close (7918) <= w2.high (7960)** - 尚未突破

#### 结论
🟡 **pending_long** - 等待突破 **7960**

---

## 💡 交易意义

### Pending状态的价值
1. **提前预警**: 在突破前就发现潜力品种
2. **风险控制**: 可以设定明确的支撑/阻力位
3. **时机把握**: Pending → Active 转变时是最佳入场点

### 操作建议
- **Pending Long**: 关注能否突破 `max(w2.high, w3.high)`
- **Pending Short**: 关注能否跌破 `min(w2.low, w3.low)`
- **止损位**: 
  - 做多止损在 `w3.low` 下方
  - 做空止损在 `w3.high` 上方

---

## 📌 代码实现位置

- **Python逻辑**: `fetch_futures.py` (Line 220-246)
- **前端筛选**: `futures.html` (Line 586)
- **红框样式**: `futures.html` (Line 195) `.pending-highlight`
- **排序置顶**: `futures.html` (Line 593-599)
